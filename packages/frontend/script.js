let PLUGIN_PATH="/cursor-pen",isPenMode=!1,permanentCanvas=null,tempCanvas=null,permCtx=null,tempCtx=null,currentTool="pen",currentColor="#FF0000",currentSize=2,isDrawing=!1,startX,startY,createCanvas=()=>{let e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.pointerEvents="none",e.style.zIndex="2147483647",e.width=window.innerWidth,e.height=window.innerHeight,e},initializeDrawing=()=>{permanentCanvas=createCanvas(),tempCanvas=createCanvas(),permCtx=permanentCanvas.getContext("2d"),tempCtx=tempCanvas.getContext("2d"),updateDrawingStyle(permCtx),updateDrawingStyle(tempCtx),document.body.appendChild(permanentCanvas),document.body.appendChild(tempCanvas)},updateDrawingStyle=e=>{e.strokeStyle=currentColor,e.lineWidth=currentSize,e.lineCap="round"},startDrawing=e=>{if(!isPenMode)return;isDrawing=!0;let t=tempCanvas.getBoundingClientRect();startX=e.clientX-t.left,startY=e.clientY-t.top,"pen"===currentTool&&(tempCtx.beginPath(),tempCtx.moveTo(startX,startY))},draw=e=>{if(!isDrawing||!isPenMode)return;let t=tempCanvas.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top;switch(tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height),currentTool){case"pen":tempCtx.lineTo(n,a),tempCtx.stroke();break;case"circle":drawCircle(tempCtx,startX,startY,n,a);break;case"square":drawSquare(tempCtx,startX,startY,n,a);break;case"blur":permCtx.save(),permCtx.filter="blur(5px)",permCtx.drawImage(permanentCanvas,n-25,a-25,50,50,n-25,a-25,50,50),permCtx.restore()}},stopDrawing=()=>{isDrawing&&(isDrawing=!1,permCtx.drawImage(tempCanvas,0,0),tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height))},drawCircle=(e,t,n,a,r)=>{let i=Math.sqrt(Math.pow(a-t,2)+Math.pow(r-n,2));e.beginPath(),e.arc(t,n,i,0,2*Math.PI),e.stroke()},drawSquare=(e,t,n,a,r)=>{let i=a-t,s=r-n;e.strokeRect(t,n,i,s)},clearCanvas=()=>{permCtx.clearRect(0,0,permanentCanvas.width,permanentCanvas.height),tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height)},togglePenMode=()=>{isPenMode=!isPenMode,document.body.style.cursor=isPenMode?"crosshair":"default",updateToolbarState(),isPenMode?(tempCanvas.style.pointerEvents="auto",permanentCanvas.style.pointerEvents="auto"):(tempCanvas.style.pointerEvents="none",permanentCanvas.style.pointerEvents="none")},createToolbar=()=>{let e=document.createElement("div");e.className="cursor-pen-toolbar",e.style.position="fixed",e.style.top="10px",e.style.right="10px",e.style.zIndex="2147483647";let t=document.createElement("button");t.textContent="Close",t.onclick=togglePenMode;let n=document.createElement("button");n.textContent="Clear",n.onclick=clearCanvas;let a=document.createElement("input");a.type="color",a.value=currentColor,a.onchange=e=>{currentColor=e.target.value,updateDrawingStyle(permCtx),updateDrawingStyle(tempCtx)};let r=document.createElement("input");r.type="number",r.min="1",r.max="50",r.value=currentSize,r.onchange=e=>{currentSize=parseInt(e.target.value),updateDrawingStyle(permCtx),updateDrawingStyle(tempCtx)};let i=document.createElement("select");return["pen","circle","square","blur"].forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=e.charAt(0).toUpperCase()+e.slice(1),i.appendChild(t)}),i.onchange=e=>{currentTool=e.target.value},e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(r),e.appendChild(i),e},updateToolbarState=()=>{let e=document.querySelector(".cursor-pen-toolbar");e&&(e.style.display=isPenMode?"block":"none")},createPage=e=>{initializeDrawing();let t=createToolbar();document.body.appendChild(t);let n=document.createElement("div");n.className="cursor-pen-instructions",n.innerHTML=`
    <h1>Screen Drawing Plugin</h1>
    <p>This plugin allows you to draw on the screen.</p>
    <p><strong>How to Activate:</strong></p>
    <ul>
      <li>Press <strong>F12</strong> to toggle the drawing mode on and off.</li>
      <li>Use the toolbar at the top-right corner to select tools, colors, and sizes.</li>
      <li>Press <strong>F12</strong> again or click the <strong>Close</strong> button to deactivate the drawing mode.</li>
    </ul>
  `,window.addEventListener("resize",()=>{permanentCanvas.width=window.innerWidth,permanentCanvas.height=window.innerHeight,tempCanvas.width=window.innerWidth,tempCanvas.height=window.innerHeight}),document.addEventListener("keydown",e=>{"F12"===e.key&&(e.preventDefault(),togglePenMode())}),tempCanvas.addEventListener("mousedown",startDrawing),tempCanvas.addEventListener("mousemove",draw),tempCanvas.addEventListener("mouseup",stopDrawing),tempCanvas.addEventListener("mouseout",stopDrawing),e.navigation.addPage(PLUGIN_PATH,{body:n})};export const init=e=>{createPage(e),e.sidebar.registerItem("Screen Drawing",PLUGIN_PATH,{icon:"fas fa-pen"})};
